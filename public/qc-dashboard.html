<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>QC Dashboard - Factory Inventory</title>
    <link rel="stylesheet" href="/css/style.css?v=20251016">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="logo">
            <i class="fas fa-industry"></i>
            <span data-i18n="app.title">Factory System</span>
        </div>

        <nav class="nav-menu">
            <div class="nav-section" data-i18n="nav.mainMenu">Menu Utama</div>
            <a href="/index.html" class="nav-item">
                <i class="fas fa-home"></i>
                <span data-i18n="nav.dashboard">Dashboard</span>
            </a>
            <a href="/inventory.html" class="nav-item">
                <i class="fas fa-boxes"></i>
                <span data-i18n="nav.materials">Bahan Baku</span>
            </a>
            <a href="/products.html" class="nav-item">
                <i class="fas fa-shoe-prints"></i>
                <span data-i18n="nav.products">Produk</span>
            </a>
            
            <div class="nav-section" data-i18n="nav.operational">Operasional</div>
            <a href="/production.html" class="nav-item">
                <i class="fas fa-cogs"></i>
                <span data-i18n="nav.production">Produksi</span>
            </a>
            <a href="/orders.html" class="nav-item">
                <i class="fas fa-shopping-cart"></i>
                <span data-i18n="nav.orders">Pesanan</span>
            </a>
            
            <div class="nav-section">Quality Control</div>
            <a href="/qc-dashboard.html" class="nav-item active">
                <i class="fas fa-chart-line"></i>
                <span>QC Dashboard</span>
            </a>
            
            <div class="nav-section" data-i18n="nav.masterData">Master Data</div>
            <a href="/suppliers.html" class="nav-item">
                <i class="fas fa-truck"></i>
                <span data-i18n="nav.suppliers">Suppliers</span>
            </a>
            <a href="/customers.html" class="nav-item">
                <i class="fas fa-users"></i>
                <span data-i18n="nav.customers">Customers</span>
            </a>
            <a href="/warehouse.html" class="nav-item">
                <i class="fas fa-warehouse"></i>
                <span data-i18n="nav.warehouse">Warehouse</span>
            </a>
            
            <div class="nav-section" data-i18n="nav.analysis">Analisis</div>
            <a href="/reports.html" class="nav-item">
                <i class="fas fa-chart-bar"></i>
                <span data-i18n="nav.reports">Laporan</span>
            </a>
            
            <div class="nav-section" data-i18n="nav.system">System</div>
            <a href="/user-management.html" class="nav-item">
                <i class="fas fa-users-cog"></i>
                <span data-i18n="nav.userManagement">User Management</span>
            </a>
            <a href="/roles.html" class="nav-item">
                <i class="fas fa-shield-alt"></i>
                <span data-i18n="nav.roles">Role Management</span>
            </a>
        </nav>
        
        <div class="sidebar-footer">
            <div class="user-info">
                <i class="fas fa-user-circle"></i>
                <div class="user-details">
                    <span class="user-name" id="userName">Loading...</span>
                    <span class="user-role" id="userRole"></span>
                </div>
            </div>
            <button onclick="logout()" class="btn-logout">
                <i class="fas fa-sign-out-alt"></i>
                <span data-i18n="app.logout">Logout</span>
            </button>
        </div>
    </aside>

    <!-- Mobile Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Topbar -->
        <div class="topbar">
            <button class="menu-toggle" onclick="toggleSidebar()" title="Toggle sidebar" aria-label="Toggle sidebar menu">
                <i class="fas fa-bars"></i>
            </button>
            <h1 class="page-title">QC Dashboard</h1>
            <div class="topbar-right">
                <!-- Language Switcher -->
                <div class="language-switcher" id="languageSwitcher">
                    <button class="lang-btn" data-lang="en" onclick="i18n.setLanguage('en')" title="English">
                        <span class="flag">ðŸ‡ºðŸ‡¸</span>
                        <span class="lang-name">EN</span>
                    </button>
                    <button class="lang-btn active" data-lang="id" onclick="i18n.setLanguage('id')" title="Bahasa Indonesia">
                        <span class="flag">ðŸ‡®ðŸ‡©</span>
                        <span class="lang-name">ID</span>
                    </button>
                    <button class="lang-btn" data-lang="zh-TW" onclick="i18n.setLanguage('zh-TW')" title="ç¹é«”ä¸­æ–‡">
                        <span class="flag">ðŸ‡¹ðŸ‡¼</span>
                        <span class="lang-name">ä¸­æ–‡</span>
                    </button>
                </div>
                <button class="btn-icon" id="notificationBtn" title="Notifications">
                    <i class="fas fa-bell"></i>
                    <span class="badge" id="notificationCount">0</span>
                </button>
            </div>
        </div>

        <!-- Dashboard Content -->
        <div class="content-wrapper">
            <!-- Stats Cards -->
            <div class="metrics-row">
                <div class="metric-card" data-loading="true">
                    <div class="metric-icon bg-primary">
                        <i class="fas fa-clipboard-list"></i>
                    </div>
                    <div class="metric-content">
                        <div class="metric-label">Total Inspected</div>
                        <div class="metric-value" id="metricTotalInspected">
                            <div class="skeleton skeleton-text"></div>
                        </div>
                        <div class="metric-change positive" id="metricInspectedChange">
                            <div class="skeleton skeleton-small"></div>
                        </div>
                    </div>
                </div>

                <div class="metric-card" data-loading="true">
                    <div class="metric-icon bg-danger">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="metric-content">
                        <div class="metric-label">Total Rejected</div>
                        <div class="metric-value" id="metricTotalRejected">
                            <div class="skeleton skeleton-text"></div>
                        </div>
                        <div class="metric-change negative" id="metricRejectedChange">
                            <div class="skeleton skeleton-small"></div>
                        </div>
                    </div>
                </div>

                <div class="metric-card" data-loading="true">
                    <div class="metric-icon bg-warning">
                        <i class="fas fa-percentage"></i>
                    </div>
                    <div class="metric-content">
                        <div class="metric-label">Reject Rate</div>
                        <div class="metric-value" id="metricRejectRate">
                            <div class="skeleton skeleton-text"></div>
                        </div>
                        <div class="metric-change positive" id="metricRateChange">
                            <div class="skeleton skeleton-small"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Filter & Actions -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-filter"></i> Filters & Controls
                    </h2>
                    <div class="card-actions">
                        <a href="/qc-inspection.html" class="btn btn-primary btn-sm">
                            <i class="fas fa-plus"></i> New Inspection
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    <div class="form-row">
                        <div class="form-group col-md-3">
                            <label for="filterPeriod">
                                <i class="fas fa-calendar"></i> Period
                            </label>
                            <select id="filterPeriod" class="form-control">
                                <option value="current">Oktober 2025</option>
                                <option value="last1">September 2025</option>
                                <option value="last2">Agustus 2025</option>
                                <option value="last3">Juli 2025</option>
                            </select>
                        </div>
                        <div class="form-group col-md-3">
                            <label for="filterProduct">
                                <i class="fas fa-box"></i> Product
                            </label>
                            <select id="filterProduct" class="form-control">
                                <option value="">All Products</option>
                            </select>
                        </div>
                        <div class="form-group col-md-3">
                            <label for="filterShift">
                                <i class="fas fa-clock"></i> Shift
                            </label>
                            <select id="filterShift" class="form-control">
                                <option value="">All Shifts</option>
                                <option value="1">Shift 1 (Pagi)</option>
                                <option value="2">Shift 2 (Siang)</option>
                                <option value="3">Shift 3 (Malam)</option>
                            </select>
                        </div>
                        <div class="form-group col-md-3">
                            <label>&nbsp;</label>
                            <div class="btn-group-block">
                                <button id="btnRefresh" class="btn btn-secondary">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-12">
                            <div class="btn-toolbar">
                                <button id="btnExportPdf" class="btn btn-danger btn-sm">
                                    <i class="fas fa-file-pdf"></i> Export PDF
                                </button>
                                <button id="btnExportExcel" class="btn btn-success btn-sm">
                                    <i class="fas fa-file-excel"></i> Export Excel
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Alert Info -->
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i>
                <span>Last Updated: <strong id="lastUpdated">-</strong></span>
            </div>

            <!-- Charts Grid - Top: Pareto Chart (Full Width) -->
            <div class="charts-container">
                <div class="chart-row chart-row-full">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-chart-bar"></i> PARETO CHART
                            </h2>
                            <div class="card-actions">
                                <button class="btn btn-sm btn-secondary" onclick="refreshParetoChart()" title="Refresh Chart">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <div id="paretoChart" class="chart-full"></div>
                            </div>
                            <div class="chart-insight" id="paretoInsights">
                                <i class="fas fa-lightbulb"></i>
                                <span>Top defects contribute to 80% of total quality issues</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts Grid - Bottom: 2 Charts Side by Side -->
                <div class="chart-row chart-row-half">
                    <!-- Left: Reject Rate Trend -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-chart-line"></i> REJECT RATE TREND
                            </h2>
                            <div class="card-actions">
                                <button class="btn btn-sm btn-secondary" onclick="refreshTrendChart()" title="Refresh Chart">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <div id="trendChart" class="chart-half"></div>
                            </div>
                            <div class="chart-insight" id="trendInsights">
                                <i class="fas fa-lightbulb"></i>
                                <span>Tracking daily reject rate performance</span>
                            </div>
                        </div>
                    </div>

                    <!-- Right: Defect Category Distribution -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-chart-pie"></i> DEFECT CATEGORY DISTRIBUTION
                            </h2>
                            <div class="card-actions">
                                <button class="btn btn-sm btn-secondary" onclick="refreshCategoryChart()" title="Refresh Chart">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <div id="categoryChart" class="chart-half"></div>
                            </div>
                            <div class="row mt-3" id="categoryBreakdown">
                                <!-- Category breakdown will be inserted here -->
                            </div>
                            <div class="chart-insight" id="categoryInsights">
                                <i class="fas fa-lightbulb"></i>
                                <span>Defect distribution by category</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Items -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-tasks"></i> Action Items & Critical Alerts
                    </h2>
                </div>
                <div class="card-body">
                    <div id="actionItemsContainer">
                        <!-- Action items will be inserted here -->
                    </div>
                </div>
            </div>

            <!-- Recent Inspections -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-history"></i> Recent Inspections
                    </h2>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Product</th>
                                    <th>Shift</th>
                                    <th>Inspected</th>
                                    <th>Defect</th>
                                    <th>Rate</th>
                                    <th>Decision</th>
                                    <th>Inspector</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="recentInspectionsTable">
                                <tr>
                                    <td colspan="9" class="text-center">Loading...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="pagination" id="inspectionPagination">
                        <!-- Pagination will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Inspection Details Modal -->
    <div id="inspectionDetailsModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>Inspection Details</h2>
                <button class="close-btn" onclick="closeInspectionDetails()">&times;</button>
            </div>
            <div class="modal-body" id="inspectionDetailsContent">
                <!-- Details will be loaded here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeInspectionDetails()">Close</button>
            </div>
        </div>
    </div>

    <script src="/js/modules/loader.js"></script>
    <script src="/js/config.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/i18n.js"></script>
    <script src="/js/role-config.js"></script>
    <script src="/js/permissions.js"></script>
    <script src="/js/main.js"></script>
    <script src="/js/qc-dashboard.js?v=20251012-fix"></script>
</body>
</html>
